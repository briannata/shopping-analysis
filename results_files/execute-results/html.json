{
  "hash": "91092cb5aa6e7b1f6b940bc1b8405649",
  "result": {
    "engine": "knitr",
    "markdown": "# Results\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(readr)\npurchase = read_csv(\"data/amazon-purchases.csv\")\nsurvey = read_csv(\"data/survey.csv\")\n\n# joined_df = merge(purchase, survey, by = \"Survey ResponseID\")\n# write.csv(joined_df, \"data/joined-amazon-purchases.csv\")\n\njoined_df = read_csv(\"data/joined-amazon-purchases.csv\")\n```\n:::\n\n\n\n\n\n\n## State Map of Total Amazon Purchases\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(dplyr)\nlibrary(ggplot2)\nlibrary(maps)\n\n# Calculate the total number of purchases in each state\ntotal_purchases_by_state <- joined_df %>%\n  group_by(`Q-demos-state`) %>%\n  summarise(total_purchases = n()) %>%\n  mutate(`Q-demos-state` = tolower(`Q-demos-state`)) %>%\n  arrange(desc(total_purchases))\n\n# Load map data for states\nstates <- map_data(\"state\")\n\n# Join the purchase data with map data\nstates_purchases <- states %>%\n  rename(`Q-demos-state` = region) %>%\n  left_join(total_purchases_by_state, by = \"Q-demos-state\")\n\n# Plot the data on a map\nggplot(states_purchases, aes(long, lat, group = group, fill = total_purchases)) +\n  geom_polygon(color = \"black\") +\n  scale_fill_viridis_c(option = \"magma\", na.value = \"gray\", direction = -1) +\n  theme_minimal() +\n  labs(title = \"Total Amazon Purchases from 2018 to 2023 by State\", fill = \"Total Purchases\")\n```\n\n::: {.cell-output-display}\n![](results_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n:::\n\n\n\n\nWe used a US state map to visualize which states made the most Amazon purchases and which had the least from 2018 to 2023. California had the greatest amount of Amazon purchases by a large margin while Texas had the second highest. We were not surprised that California had the most purchases, but we were surprised that Texas was second. A lot of the midwest states, such as Montana, North Dakota, South Dakota, and Wyoming had the least amount of Amazon purchases. \n  \n## Grouped Bar Chart of Top 5 Categories Per Year\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(RColorBrewer)\n\n# Convert Order Date to Date type\npurchase$`Order Date` <- as.Date(purchase$`Order Date`, format=\"%Y-%m-%d\")\n\n# Extract Year from Order Date\npurchase$Year <- format(purchase$`Order Date`, \"%Y\")\n\n# Group by Year and Category to count purchases\ncategory_counts <- purchase %>%\n  group_by(Year, Category) %>%\n  summarise(purchases = n()) %>%\n  ungroup()\n\n# Remove 'NA' categories and filter out the year 2024\ncategory_counts <- category_counts %>%\n  filter(Category != \"NA\" & Year != \"2024\")\n\n# Get the top 5 most purchased categories for each year\ntop_categories <- category_counts %>%\n  group_by(Year) %>%\n  top_n(5, purchases) %>%\n  ungroup()\n\n# Order categories within each year by number of purchases (tallest to shortest)\ntop_categories$Category <- factor(top_categories$Category, \n                                   levels = top_categories %>%\n                                     group_by(Year) %>%\n                                     arrange(Year, desc(purchases)) %>%\n                                     pull(Category) %>%\n                                     unique())\n\n# Choose a qualitative color palette\npalette <- brewer.pal(8, \"Set2\")\n\n# Create the grouped bar graph\nggplot(top_categories, aes(x = Year, y = purchases, fill = Category)) +\n  geom_bar(stat = \"identity\", position = \"dodge\") +\n  labs(title = \"Top 5 Most Purchased Amazon Categories by Year\",\n       x = \"Year\", y = \"Number of Purchases\") +\n  scale_fill_manual(values = palette) +\n  theme_minimal() +\n  theme(axis.text.x = element_text(angle = 45, hjust = 1))\n```\n\n::: {.cell-output-display}\n![](results_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n\n\n\nThis grouped bar chart shows the top purchases per year. For each year, books are consistently the top category purchased, followed by pet food. However, in 2022 and 2023, gift cards were no longer considered a top category and instead, medicine appeared.\nPeople also bought more nutritional supplements than shirts until 2021 and 2022, and then in 2023 nutritional supplements were more popular again. \n  \n  \n## Distribution of User's Total Spending on Amazon\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Calculate total spending per user\nuser_spending <- joined_df %>%\n  mutate(Total_Spent = `Purchase Price Per Unit` * Quantity) %>%\n  group_by(`Survey ResponseID`) %>%\n  summarise(Total_Spent_Per_User = sum(Total_Spent, na.rm = TRUE))\n\n# Plot a histogram of total spending per user\nggplot(user_spending, aes(x = Total_Spent_Per_User)) +\n  geom_histogram(binwidth = 1000, fill = \"blue\", color = \"black\", alpha = 0.7) +\n  labs(\n    title = \"Distribution of Total Spending from 2018 to 2023 Per Account\",\n    x = \"Total Spending (USD)\",\n    y = \"Number of Accounts\"\n  ) +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](results_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n\n\n\nThis histogram shows the distribution of user's total spending over 5 years. The number of accounts is the frequency of Amazon users/accounts that spend that much over a total of 5 years. The majority of users spend less than $30,000 in 5 years, with the highest peak being $2,000 within 5 years. This histogram however is right skewed with some users spending almost $12,000 over the 5 year period. Knowing the distribution is skewed we may need to do something with our outliers when we use our data for our other visualizations.\n\n## Alluvial Diagram of Age, Amazon Category, and Income for 2023\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggalluvial)\n\n# Filter for rows where \"2023\" is in the \"Order Date\"\n# and find the top 5 categories by frequency\ntop_categories <- joined_df %>%\n  filter(grepl(\"2023\", `Order Date`)) %>%\n  count(Category, sort = TRUE) %>%\n  slice_max(n, n = 5) %>%\n  pull(Category)\n\n# Filter the data for the top 5 categories\nalluvial_data <- joined_df %>%\n  filter(grepl(\"2023\", `Order Date`) & Category %in% top_categories) %>%\n  select(`Q-demos-age`, Category, `Q-demos-income`) %>%\n  filter(!is.na(`Q-demos-age`) & !is.na(Category) & !is.na(`Q-demos-income`))\n\n# Create the alluvial diagram\nggplot(alluvial_data,\n       aes(axis1 = `Q-demos-age`, axis2 = Category, axis3 = factor(`Q-demos-income`, levels = c(\"Less than $25,000\", \"$25,000 - $49,999\", \"$50,000 - $74,999\",\"$75,000 - $99,999\", \"$100,000 - $149,999\", \"$150,000 or more\", \"Prefer not to say\")))) +\n  geom_flow(aes(fill = Category)) +\n  geom_stratum(width = 0.6) +\n  geom_text(stat = \"stratum\", aes(label = after_stat(stratum)), size = 2.5) +\n  theme_minimal() +\n  labs(title = \"Alluvial Diagram of Age, Category, and Income for 2023\",\n       x = \"Variables\",\n       y = \"Frequency\") +\n  scale_x_discrete(labels = c(\"Age\", \"Category\", \"Income\")) +\n  theme(\n    legend.position = \"top\",            # Move legend to the top\n    legend.title = element_blank(),     # Optional: remove legend title for a cleaner look\n    axis.text.x = element_text(angle = 45, hjust = 1),  # Optional: tilt axis labels\n    plot.margin = margin(10, 10, 10, 10)                # Reduce blank margins\n  )\n```\n\n::: {.cell-output-display}\n![](results_files/figure-html/unnamed-chunk-5-1.png){width=960}\n:::\n:::\n\n\n\n\nWe saw the top categories in the bar chart so now we are using an alluvial diagram to see the flow between the demographics,  age and income, and the top 5 categories to find any trends or patterns. The book category has the most flow with the younger age groups buying more books on Amazon. This doesn't mean that younger people read more and older people do not, it just shows that for this study these younger participants are buying more books online through Amazon. The second most frequent purchase category is pet food and we can see people from ages 24-54 are the top customers and usually they have a higher income. It was interesting to see that medication was the most popular for users between 24 and 44 years old with medium incomes at $25,000 - $74,999. This graph gave more insight into the interaction between variables when looking at the top categories.\n\n## Mosiac Pairs Plot of Gender, Purchases Per Week, and Education\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(vcd)\nsurvey = filter(survey, `Q-demos-gender` == 'Female' | `Q-demos-gender` == 'Male')\nsurvey = filter(survey, `Q-demos-education`!='Prefer not to say')\n\nsurvey = mutate(survey, `Q-demos-education` = ifelse(survey$`Q-demos-education`== \"Some High School or Less High School\" , \"< High School\", survey$`Q-demos-education`))\nsurvey = mutate(survey, `Q-demos-education` = ifelse(`Q-demos-education`== \"Bachelor's degree\", \"Bachelors\", survey$`Q-demos-education`))\nsurvey = mutate(survey, `Q-demos-education` = ifelse(`Q-demos-education`== \"Graduate or professional degree (MA, MS, MBA, PhD, JD, MD, DDS, etc)\", \"Graduate\", survey$`Q-demos-education`))\nsurvey = mutate(survey, `Q-demos-education` = ifelse(`Q-demos-education`== \"Graduate/Professional Degree\", \"Graduate\", survey$`Q-demos-education`))\nsurvey = mutate(survey, `Q-demos-education` = ifelse(`Q-demos-education`== \"Some high school or less\", \"<High School\", survey$`Q-demos-education`))\nsurvey = mutate(survey, `Q-demos-education` = ifelse(`Q-demos-education`== \"High school diploma or GED\", \"High School\", survey$`Q-demos-education`))\nunique(survey$`Q-demos-education`)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"High School\"  \"Graduate\"     \"Bachelors\"    \"<High School\"\n```\n\n\n:::\n\n```{.r .cell-code}\nsurvey = mutate(survey, `Q-amazon-use-how-oft` = ifelse(`Q-amazon-use-how-oft`== \"Less than 5 times per month\", \"<5 a month\", survey$`Q-amazon-use-how-oft`))\nsurvey = mutate(survey, `Q-amazon-use-how-oft` = ifelse(`Q-amazon-use-how-oft`== \"5 - 10 times per month\", \"5-10 a month\", survey$`Q-amazon-use-how-oft`))\nsurvey = mutate(survey, `Q-amazon-use-how-oft` = ifelse(`Q-amazon-use-how-oft`== \"More than 10 times per month\", \">10 a month\", survey$`Q-amazon-use-how-oft`))\n\nvariables <- c(\"Q-demos-gender\", \n               \"Q-amazon-use-how-oft\", \n               \"Q-demos-education\")\n\n# Filter the dataset to include only these variables\ndata_for_mosaic <- survey %>%\n  select(all_of(variables)) %>%\n  na.omit() # Remove rows with NA values\n\n# Generate the mosaic plot\npairs(table(data_for_mosaic), \n      diag_panel = pairs_diagonal_mosaic(offset_varnames=-2.5),cex=1,\n      upper_panel_args = list(shade = TRUE),\n      lower_panel_args = list(shade = TRUE),\n      main = \"Mosaic Pairs Plot of Gender, Purchases Per Week, and Education\")\n```\n\n::: {.cell-output-display}\n![](results_files/figure-html/unnamed-chunk-6-1.png){width=1152}\n:::\n:::\n\n\n\n\nTo see if the variables have a strong association we used a mosaic plot. Gender and education levels were strongly associated. However, for our topic we are more interested in the association with how often the user purchases from Amazon a month (shopping frequency). When looking at all three variables together, they were not strongly associated. Then if we just look at gender and how often the user shops on Amazon, there appears to be more of an association compared to education level and shopping frequency.   \n",
    "supporting": [
      "results_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}